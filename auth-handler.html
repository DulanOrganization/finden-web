<!DOCTYPE html>
<html>
  <head>
    <title>OAuth Handler</title>
    <script>
      // This script extracts the code from the query parameters
      (function () {
        console.log('Window location');
        console.log(window.location.search);
        // Parse query parameters
        const params = new URLSearchParams(window.location.search);
        const authCode = params.get("code");
        const accessToken = params.get("access_token");
        const idToken = params.get("id_token");

        console.log('Window location auth code');
        console.log(authCode);
        console.log('Window location access token');
        console.log(accessToken);
        console.log('Window location id token');
        console.log(idToken);

        // Pass the authorization code back to the Flutter app
        if (authCode) {
          // Communicate with the parent window (Flutter app)
          window.opener.postMessage({ code: authCode }, "*");
        } else if (accessToken || idToken) {
          // Communicate with the parent window (Flutter app)
          window.opener.postMessage({ access_token: accessToken, id_token: idToken }, "*");
        }

        // Close the popup automatically
        window.close();
      })();
    </script>
  </head>
  <body>
    <p>Authorizing...</p>
  </body>
</html>
